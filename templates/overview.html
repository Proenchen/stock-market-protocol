<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Stock Market Protocol</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
</head>

<body>
    <nav class="navbar bg-dark navbar-expand-lg border-bottom border-body px-4" id="navbar" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/home">Global Stock Market Protocol</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/home">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/upload">Upload</a></li>
                    <li class="nav-item dropdown">
                        <button class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                            aria-expanded="false">Code</button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/overview">Overview</a></li>
                            <li><a class="dropdown-item" href="/setup">Setup</a></li>
                            <li><a class="dropdown-item" href="/usage">Extension</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li>
                    <li class="nav-item">
                        <button id="theme-switch">
                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"
                                fill="#e3e3e3">
                                <path
                                    d="M479.96-144Q340-144 242-242t-98-238q0-140 97.93-238t237.83-98q13.06 0 25.65 1 12.59 1 25.59 3-39 29-62 72t-23 92q0 85 58.5 143.5T648-446q49 0 92-23t72-62q2 13 3 25.59t1 25.65q0 139.9-98.04 237.83t-238 97.93Z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"
                                fill="#e3e3e3">
                                <path
                                    d="M479.77-288Q400-288 344-344.23q-56-56.22-56-136Q288-560 344.23-616q56.22-56 136-56Q560-672 616-615.77q56 56.22 56 136Q672-400 615.77-344q-56.22 56-136 56ZM216-444H48v-72h168v72Zm696 0H744v-72h168v72ZM444-744v-168h72v168h-72Zm0 696v-168h72v168h-72ZM269-642 166-742l51-55 102 104-50 51Zm474 475L642-268l49-51 103 101-51 51ZM640-691l102-101 51 49-100 103-53-51ZM163-217l105-99 49 47-98 104-56-52Z" />
                            </svg>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <h1 class="mb-4">Architecture</h1>
        <p>The architecture of our framework follows a layered design that separates concerns between data storage,
            protocol handling, backend logic, and user interaction. The dependencies between the layers are strictly
            from top to bottom, which facilitates maintainability and extensibility. The main layers can be summarized as follows:</p>
        <ul>
            <li><strong>Data Layer:</strong> Responsible for storing market data. It contains all the data required to
                perform the portfolio tests, including CRSP data, factor data, and a specific dataset for the
                Famaâ€“MacBeth analysis.</li>

            <li><strong>Protocol Layer:</strong> Encapsulates the core functionality of the stock market protocol. This
                layer defines the protocols for testing the given anomaly, such as the implementation of factor models
                or the Fama-Macbeth regression. By strictly separating protocol logic from other parts of the system,
                the framework ensures that it can evolve independently of presentation concerns.</li>

            <li><strong>Application Layer:</strong> Implements the main logic of the system, including data validation
                and orchestration of protocol operations. This layer acts as the central mediator between the data and
                protocol layers, ensuring that input is transformed into meaningful output while maintaining system
                integrity.</li>

            <li><strong>Interface Layer:</strong> Provides access points for end-users and external applications. On the
                server side, a lightweight Flask application exposes REST-like endpoints. On the client side, a web
                frontend built with HTML, CSS, and Bootstrap ensures usability and responsiveness across devices.</li>
        </ul>

        <div class="text-center my-5">
            <img src="{{ url_for('static', filename='images/class_diagram.png') }}" class="img-fluid"
                alt="Class Diagram">
        </div>

        <p>The class diagram illustrates the separation of responsibilities between core protocol classes, utility
            modules, and interface components. The <code>data</code> package represents the data layer, providing all
            required market data. The <code>analyzers</code> package embodies the protocol layer, containing the concrete
            implementations of anomaly analysis methods. All analyzers inherit from <code>BaseAnalyzer</code>, which
            defines the main analysis methods and output generation logic.</p>

        <p>We adopted a service discovery pattern to enable automatic detection of both existing and newly added
            analyzers. This pattern facilitates dynamic identification of system components without manual configuration.
            Within our framework, any newly implemented analyzer inheriting from <code>AutoRegistry</code> is
            automatically discovered and integrated into the analysis pipeline.</p>

        <p>The <code>Analysis</code> class forms the application layer. It retrieves enabled analyzers, executes them in
            order, collects results, and uses the <code>Composer</code> class to generate the final LaTeX document. The
            <code>App</code> class then delivers this result to the user via email and manages user file uploads.</p>

        <p>The frontend, implemented using HTML, CSS, and Bootstrap, serves as the interface layer. It communicates with
            Flask-based REST endpoints (via <code>GET</code> and <code>POST</code> requests) to send input files and
            retrieve analysis results.</p>

        <p>The complete analysis workflow is illustrated by the following activity diagram:</p>

        <div class="text-center my-5">
            <img src="{{ url_for('static', filename='images/activity.png') }}" class="img-fluid"
                alt="Activity Diagram">
        </div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 Global Stock Market Protocol by Julian Shen and Jiexuan Gao</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
