<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Stock Market Protocol</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script src="{{ url_for('static', filename='js/copy.js') }}"></script>
</head>

<body>
    <nav class="navbar bg-dark navbar-expand-lg border-bottom border-body px-4" id="navbar" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/home">Global Stock Market Protocol</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/home">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/upload">Upload</a></li>
                    <li class="nav-item dropdown">
                        <button class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                            aria-expanded="false">Code</button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/overview">Overview</a></li>
                            <li><a class="dropdown-item" href="/setup">Setup</a></li>
                            <li><a class="dropdown-item" href="/usage">Extension</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li>
                    <li class="nav-item">
                        <button id="theme-switch">
                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"
                                fill="#e3e3e3">
                                <path
                                    d="M479.96-144Q340-144 242-242t-98-238q0-140 97.93-238t237.83-98q13.06 0 25.65 1 12.59 1 25.59 3-39 29-62 72t-23 92q0 85 58.5 143.5T648-446q49 0 92-23t72-62q2 13 3 25.59t1 25.65q0 139.9-98.04 237.83t-238 97.93Z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"
                                fill="#e3e3e3">
                                <path
                                    d="M479.77-288Q400-288 344-344.23q-56-56.22-56-136Q288-560 344.23-616q56.22-56 136-56Q560-672 616-615.77q56 56.22 56 136Q672-400 615.77-344q-56.22 56-136 56ZM216-444H48v-72h168v72Zm696 0H744v-72h168v72ZM444-744v-168h72v168h-72Zm0 696v-168h72v168h-72ZM269-642 166-742l51-55 102 104-50 51Zm474 475L642-268l49-51 103 101-51 51ZM640-691l102-101 51 49-100 103-53-51ZM163-217l105-99 49 47-98 104-56-52Z" />
                            </svg>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1>Guide for extending our code base</h1>

        <ol class="list-group list-group-unnumbered">

            <!-- 1. Guide intro -->
            <li class="list-group-item border-0 px-0">
                <h5 class="fw-semibold mb-2">1. Add new analyzer class</h5>
                <p class="mb-2">
                    Due to the service discovery pattern, integrating new portfolio tests is
                    straightforward.
                    Implement a new analyzer by inheriting from <code>BaseAnalyzer</code> and
                    <code>AutoRegistered</code>,
                    then implement the abstract methods <code>analyze()</code> and <code>generate_output()</code>.
                    Donâ€™t forget to provide the class constants <code>ENABLED</code>, <code>ORDER</code>, and
                    <code>TITLE</code>.
                </p>
                <div class="position-relative">
                    <pre class="bg-dark text-light p-3 rounded mt-3"><code>from logic.analyzers.base import BaseAnalyzer
from logic.analyzers.base import AutoRegistered, AnalyzerOutput

class NewAnalyzer(BaseAnalyzer, AutoRegistered):
    ENABLED = True
    ORDER = 10
    TITLE = "&lt;Title in result document for this analyzer&gt;"

    def __init__(self, ctx, df_input, signal_name):
        super().__init__(ctx, df_input, signal_name)

    def analyze(self):
        # Your test logic...

    def generate_output(self) -> AnalyzerOutput:
        # Use the result of analyze() to generate the LaTeX blocks and/or string output...
</code></pre>
                </div>
                <p class="mt-2">
                    If you run the analysis, this class will be automatically discovered and
                    <code>generate_output()</code> will be executed automatically.
                </p>
            </li>

            <!-- 2. Extend datasets -->
            <li class="list-group-item border-0 px-0">
                <h5 class="fw-semibold mb-2">2. Extend datasets</h5>
                <p class="mb-2">
                    To add datasets for analysis, place your <code>.csv</code> files in the
                    <code>data</code> package and extend the <code>SharedContext</code> dataclass:
                </p>
                <div class="position-relative">
                    <pre class="bg-dark text-light p-3 rounded mt-3"><code>from dataclasses import dataclass
import pandas as pd

@dataclass
class SharedContext:
    crsp: pd.DataFrame
    factors: pd.DataFrame
    fm: pd.DataFrame
    correlation_data: pd.DataFrame
    new_data: pd.DataFrame  # NEW
</code></pre>
                </div>
                <p class="mt-3">Add paths to the new datasets in the <code>Analysis</code> class:</p>
                <div class="position-relative">
                    <pre class="bg-dark text-light p-3 rounded mt-3"><code>import pandas as pd

class Analysis:
    @staticmethod
    def run_complete_analysis(df: pd.DataFrame, signal_name: str) -> str:
        crsp_full = pd.read_csv("./data/dsws_crsp.csv")
        factors_full = pd.read_csv("./data/Factors.csv")
        fm_full = pd.read_csv("./data/Fama_Macbeth.csv")
        corr_full = pd.read_parquet("./data/Predictor_different.parquet")
        new_data = pd.read_csv("./data/New_Data.csv")  # NEW

        ctx = SharedContext(
            crsp=crsp_full,
            factors=factors_full,
            fm=fm_full,
            correlation_data=corr_full,
            new_data=new_data
        )
</code></pre>
                </div>
            </li>

            <!-- 3. Wire new data in BaseAnalyzer -->
            <li class="list-group-item border-0 px-0">
                <h5 class="fw-semibold mb-2">3. Wire new data into <code>BaseAnalyzer</code></h5>
                <p class="mb-2">
                    Make sure your base class exposes the new dataset to analyzers:
                </p>
                <div class="position-relative">
                    <pre class="bg-dark text-light p-3 rounded mt-3"><code>from abc import ABC

class BaseAnalyzer(ABC):
    ENABLED: bool
    ORDER: int
    TITLE: str

    def __init__(self, ctx, df_input, signal_name) -&gt; None:
        self.data = df_input
        self.crsp = ctx.crsp
        self.factors = ctx.factors
        self.fm = ctx.fm
        self.corr = ctx.correlation_data
        self.new_data = ctx.new_data  # NEW
        self.signal_name = signal_name
</code></pre>
                </div>
                <p class="mt-2">
                    <strong>Tip:</strong> Check existing analyzers for patterns and utility methods you can reuse.
                </p>
            </li>

        </ol>
    </div>

    <div class="footer">
        <p>&copy; 2025 Global Stock Market Protocol by Julian Shen and Jiexuan Gao</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>